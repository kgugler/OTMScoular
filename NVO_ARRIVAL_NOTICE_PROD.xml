<?xml version="1.0" encoding="utf-8"?>
<dataTemplate name="NVO_ARRIVAL_NOTICE" description="NVO Arrival Notice" dataSourceRef="ORCL" defaultPackage="" version="1.0">
  <parameters>
    <parameter name="JOB_ID" dataType="character" />
    <parameter name="P_RUN" dataType="character" />
    <parameter name="P_REPORT_GID" dataType="character" />
    <parameter name="P_DISPLAY_NAME" dataType="character" />
    <parameter name="P_DOMAIN" dataType="character" />
    <parameter name="P_GL_USER" dataType="character"></parameter>
  </parameters>
  <lexicals></lexicals>
  <dataQuery>
    <sqlStatement name="Q_DRAFT_FINAL"><![CDATA[SELECT :P_RUN draft_final FROM DUAL]]></sqlStatement>
    <sqlStatement name="Q_MAIN"><![CDATA[SELECT
	glogowner.xxscou_nvo_report_functions.entity_name(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER')
  loc_name,
	TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER','1') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER','2') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER','3'))
  loc_address,
  TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER',',') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER'))
  loc_city_state_zip,
	glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER','Phone:')
  loc_phone,    
  TO_CHAR(TO_DATE(SYSDATE,'dd-mm-rr'),'fmMM/DD/YY') system_date,
  'TSFE' || j.job_xid tsc_ref_num,
	glogowner.xxscou_nvo_report_functions.entity_fullname(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER')
  contact_name, 
  TRIM(glogowner.xxscou_nvo_report_functions.entity_email(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_phone(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER'))
  contact_email_phone,
	glogowner.xxscou_nvo_report_functions.entity_name(s.shipment_gid,'XXX','BROKER ID')
  bill_name,
	TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','BROKER ID','1') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','BROKER ID','2') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','BROKER ID','3')) 
  bill_address,
  TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','BROKER ID',',') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','BROKER ID') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','BROKER ID') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','BROKER ID'))
  bill_city_state_zip,
	glogowner.xxscou_nvo_report_functions.entity_fullname(s.shipment_gid,'XXX','BROKER ID')
  bill_contact,  
	glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','BROKER ID','Phone:')
  bill_phone,
	glogowner.xxscou_nvo_report_functions.entity_fax_with_label(s.shipment_gid,'XXX','BROKER ID','Fax:')
  bill_fax,
  j.attribute3 cust_ref_no,
  j.attribute5 master_bill_lading,  
  (CASE WHEN sref3.shipment_refnum_value IS NULL THEN
    'TSFE' || j.job_xid
  ELSE
    sref3.shipment_refnum_value
  END) house_bill_lading,  
  (CASE WHEN sref3.shipment_refnum_value IS NULL THEN
    'TSFE' || j.job_xid
  ELSE
    sref3.shipment_refnum_value
  END) ams_bill_lading,   
  (CASE WHEN sref4.shipment_refnum_value IS NULL THEN
    sref5.shipment_refnum_value
  ELSE
    sref4.shipment_refnum_value
  END) vessel_name,  
	cvr1.charter_voyage_refnum_value voyage_name,    
  glogowner.xxscou_nvo_report_functions.port_ship_char_loc(s.shipment_gid,'SCOULAR/NVO.PORT OF LOAD',cv.charter_voyage_gid,'SCOULAR/NVO.VIA_LOCATION_ID',cv.source_location_gid)
  load_port,
	glogowner.xxscou_nvo_report_functions.port_ship_char_loc_pr(s.shipment_gid,'SCOULAR/NVO.PORT OF DISCHARGE',cv.charter_voyage_gid,'SCOULAR.CHARVOY_VIA_PORT_OF_DISCHARGE',cv.dest_location_gid) 
  discharge_port,
  TO_CHAR(TO_DATE(cv.departure_date,'dd-mm-rr'),'fmMM/DD/YY') departure_date,    
  TO_CHAR(TO_DATE(cv.arrival_date,'dd-mm-rr'),'fmMM/DD/YY') arrival_date,
  (CASE WHEN sref6.shipment_refnum_value = 'DD' THEN 'Door-to-Door'
  WHEN sref6.shipment_refnum_value = 'DP' THEN 'Door-to-Pier'
  WHEN sref6.shipment_refnum_value = 'PD' THEN 'Pier-to-Door'
  WHEN sref6.shipment_refnum_value = 'PP' THEN 'Pier-to-Pier'
  WHEN sref6.shipment_refnum_value = 'RP' THEN 'Rail-to-Pier'
  WHEN sref6.shipment_refnum_value = 'RD' THEN 'Rail-to-Door'
  WHEN sref6.shipment_refnum_value = 'RR' THEN 'Rail-to-Rail'
  WHEN sref6.shipment_refnum_value = 'PR' THEN 'Pier-to-Rail'
  WHEN sref6.shipment_refnum_value = 'DR' THEN 'Door-to-Rail'
  ELSE sref6.shipment_refnum_value
  END) service_type,
  (SELECT lr.location_refnum_value
  FROM location_refnum lr
  WHERE lr.location_gid = 'SCOULAR.' || REPLACE(cvr2.charter_voyage_refnum_value,'SCOULAR.','')
  AND lr.location_refnum_qual_gid = 'SCOULAR.FIRMS CODE')
  clear_at_firms,  
  (SELECT l.location_name FROM location l WHERE l.location_gid = 'SCOULAR.' || REPLACE(cvr2.charter_voyage_refnum_value,'SCOULAR.',''))
  firms_name,
  glogowner.xxscou_nvo_report_functions.loc_address('SCOULAR.' || REPLACE(cvr2.charter_voyage_refnum_value,'SCOULAR.',''))
  firms_address,
  glogowner.xxscou_nvo_report_functions.loc_city_state_zip('SCOULAR.' || REPLACE(cvr2.charter_voyage_refnum_value,'SCOULAR.',''))
  firms_city_state_zip,  
  sref1.shipment_refnum_value place_of_delivery,
  sref2.shipment_refnum_value bill_type,
  s.payment_method_code_gid freight_pay_term,
  (SELECT lr.location_refnum_value
  FROM location_refnum lr
  WHERE lr.location_gid = sip.involved_party_contact_gid
  AND lr.location_refnum_qual_gid = 'SCOULAR/NVO.CUSTOMER PAYMENT TERMS')
  freight_inco_term,
  TO_CHAR((SELECT COUNT(ssunit.s_ship_unit_gid)
  FROM shipment_stop_d sstopd
  INNER JOIN s_ship_unit ssunit ON sstopd.s_ship_unit_gid = ssunit.s_ship_unit_gid
  WHERE sstopd.shipment_gid = s.shipment_gid
  AND sstopd.stop_num = 1),'999,999,990') container_count,  
  TO_CHAR((SELECT SUM(TO_NUMBER(ssur.refnum_value))
  FROM shipment_stop_d ssd
  INNER JOIN s_ship_unit ssu ON ssd.s_ship_unit_gid = ssu.s_ship_unit_gid
  LEFT OUTER JOIN s_ship_unit_refnum ssur ON ssu.s_ship_unit_gid = ssur.s_ship_unit_gid
  AND ssur.s_ship_unit_refnum_qual_gid = 'SCOULAR.PIECE COUNT'
  WHERE ssd.shipment_gid = s.shipment_gid
  AND ssd.stop_num = 1),'999,999,990') piece_tot,
  srem1.remark_text additional_notes  
FROM
  job j
INNER JOIN
  job_order_release_join jorj ON j.job_gid = jorj.job_gid
INNER JOIN
  view_shipment_order_release vsor ON jorj.order_release_gid = vsor.order_release_gid
AND
  vsor.shipment_gid IN (
  SELECT sh.shipment_gid
  FROM shipment sh
  WHERE vsor.shipment_gid = sh.shipment_gid
  AND sh.shipment_type_gid = 'TRANSPORT'
  AND sh.transport_mode_gid = 'VESSEL-CO'
  AND sh.is_primary = 'Y'
  AND sh.perspective = 'B')  
INNER JOIN
	shipment s ON vsor.shipment_gid = s.shipment_gid
AND
	s.shipment_type_gid = 'TRANSPORT'
AND
	s.transport_mode_gid = 'VESSEL-CO'
AND
	s.is_primary = 'Y'
AND
  s.perspective = 'B'
LEFT OUTER JOIN
	shipment_refnum sr ON s.shipment_gid = sr.shipment_gid
AND
	sr.shipment_refnum_qual_gid = 'CHARTER VOYAGE'		
LEFT OUTER JOIN
	charter_voyage cv ON 'SCOULAR/NVO.' || sr.shipment_refnum_value = cv.charter_voyage_gid
LEFT OUTER JOIN
  vessel v ON cv.vessel_gid = v.vessel_gid  
LEFT OUTER JOIN
	charter_voyage_refnum cvr1 ON cv.charter_voyage_gid = cvr1.charter_voyage_gid
AND
	cvr1.charter_voyage_refnum_qual_gid = 'SCOULAR.CHARVOY_VOYAGE_NUMBER'
LEFT OUTER JOIN
	charter_voyage_refnum cvr2 ON cv.charter_voyage_gid = cvr2.charter_voyage_gid
AND
	cvr2.charter_voyage_refnum_qual_gid = 'SCOULAR.CHARVOY_FIRMS_CODE'    
LEFT OUTER JOIN
	shipment_refnum sref1 ON s.shipment_gid = sref1.shipment_gid
AND
	sref1.shipment_refnum_qual_gid = 'SCOULAR/NVO.PLACE OF DELIVERY'
LEFT OUTER JOIN
	shipment_refnum sref2 ON s.shipment_gid = sref2.shipment_gid
AND
	sref2.shipment_refnum_qual_gid = 'SCOULAR/NVO.HB_BL TYPE'
LEFT OUTER JOIN
	shipment_refnum sref3 ON s.shipment_gid = sref3.shipment_gid
AND
	sref3.shipment_refnum_qual_gid = 'SCOULAR/NVO.HBL NUMBER OVERRIDE'	
LEFT OUTER JOIN
	shipment_refnum sref4 ON s.shipment_gid = sref4.shipment_gid
AND
	sref4.shipment_refnum_qual_gid = 'SCOULAR/NVO.VESSEL_VOYAGE'  
LEFT OUTER JOIN
	shipment_refnum sref5 ON s.shipment_gid = sref5.shipment_gid
AND
	sref5.shipment_refnum_qual_gid = 'SCOULAR/NVO.BOOKING_VESSEL_VOYAGE' 
LEFT OUTER JOIN
	shipment_refnum sref6 ON s.shipment_gid = sref6.shipment_gid
AND
	sref6.shipment_refnum_qual_gid = 'SCOULAR/NVO.SERVICE TYPE'     
LEFT OUTER JOIN
	shipment_remark srem1 ON s.shipment_gid = srem1.shipment_gid
AND
	srem1.remark_qual_gid = 'SCOULAR.ADDITIONAL NOTES'
LEFT OUTER JOIN
  shipment_involved_party sip ON s.shipment_gid = sip.shipment_gid
AND
  sip.involved_party_qual_gid = 'BILL-TO'  
WHERE
	j.job_gid = :JOB_ID
AND
	:P_RUN = 'FINAL'
UNION
SELECT
	NVL(glogowner.xxscou_nvo_report_functions.entity_name(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER'), 'Data Missing in System') 
  loc_name,
	NVL(TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER','1') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER','2') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER','3')), 'Data Missing in System') 
  loc_address,
  NVL(TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER',',') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER')), 'Data Missing in System') 
  loc_city_state_zip,
	NVL(glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER','Phone:'), 'Data Missing in System')  
  loc_phone,  
  TO_CHAR(TO_DATE(SYSDATE,'dd-mm-rr'),'fmMM/DD/YY') system_date,
  'TSFE' || NVL(j.job_xid, ' Data Missing in System') tsc_ref_num,
	NVL(glogowner.xxscou_nvo_report_functions.entity_fullname(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER'), 'Data Missing in System')
  contact_name, 
  NVL(TRIM(glogowner.xxscou_nvo_report_functions.entity_email(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_phone(s.shipment_gid,'XXX','SCOULAR/NVO.OPS MANAGER')), 'Data Missing in System')
  contact_email_phone,
	NVL(glogowner.xxscou_nvo_report_functions.entity_name(s.shipment_gid,'XXX','BROKER ID'), 'Data Missing in System') 
  bill_name,
	NVL(TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','BROKER ID','1') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','BROKER ID','2') || ' ' ||
  glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','BROKER ID','3')), 'Data Missing in System') 
  bill_address,
  NVL(TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','BROKER ID',',') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','BROKER ID') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','BROKER ID') || ' ' || 
  glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','BROKER ID')), 'Data Missing in System') 
  bill_city_state_zip,
	NVL(glogowner.xxscou_nvo_report_functions.entity_fullname(s.shipment_gid,'XXX','BROKER ID'), 'Data Missing in System') 
  bill_contact,  
	NVL(glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','BROKER ID','Phone:'), 'Data Missing in System')  
  bill_phone,
	NVL(glogowner.xxscou_nvo_report_functions.entity_fax_with_label(s.shipment_gid,'XXX','BROKER ID','Fax:'), 'Data Missing in System')  
  bill_fax,   
  NVL(j.attribute3, 'Data Missing in System') cust_ref_no,
  NVL(j.attribute5, 'Data Missing in System') master_bill_lading, 
  (CASE WHEN sref3.shipment_refnum_value IS NULL THEN
    'TSFE' || NVL(j.job_xid, ' Data Missing in System') 
  ELSE
    sref3.shipment_refnum_value
  END) house_bill_lading,  
  (CASE WHEN sref3.shipment_refnum_value IS NULL THEN
    'TSFE' || NVL(j.job_xid, ' Data Missing in System') 
  ELSE
    sref3.shipment_refnum_value
  END) ams_bill_lading, 
  NVL((CASE WHEN sref4.shipment_refnum_value IS NULL THEN
    sref5.shipment_refnum_value
  ELSE
    sref4.shipment_refnum_value
  END), 'Data Missing in System') vessel_name,  
	NVL(cvr1.charter_voyage_refnum_value, 'Data Missing in System') voyage_name,    
  NVL(glogowner.xxscou_nvo_report_functions.port_ship_char_loc(s.shipment_gid,'SCOULAR/NVO.PORT OF LOAD',cv.charter_voyage_gid,'SCOULAR/NVO.VIA_LOCATION_ID',cv.source_location_gid), 'Data Missing in System')
  load_port,
	NVL(glogowner.xxscou_nvo_report_functions.port_ship_char_loc_pr(s.shipment_gid,'SCOULAR/NVO.PORT OF DISCHARGE',cv.charter_voyage_gid,'SCOULAR.CHARVOY_VIA_PORT_OF_DISCHARGE',cv.dest_location_gid), 'Data Missing in System') 
  discharge_port, 
  NVL(TO_CHAR(TO_DATE(cv.departure_date,'dd-mm-rr'),'fmMM/DD/YY'), 'Data Missing in System') departure_date,    
  NVL(TO_CHAR(TO_DATE(cv.arrival_date,'dd-mm-rr'),'fmMM/DD/YY'), 'Data Missing in System') arrival_date,
  NVL((CASE WHEN sref6.shipment_refnum_value = 'DD' THEN 'Door-to-Door'
  WHEN sref6.shipment_refnum_value = 'DP' THEN 'Door-to-Pier'
  WHEN sref6.shipment_refnum_value = 'PD' THEN 'Pier-to-Door'
  WHEN sref6.shipment_refnum_value = 'PP' THEN 'Pier-to-Pier'
  WHEN sref6.shipment_refnum_value = 'RP' THEN 'Rail-to-Pier'
  WHEN sref6.shipment_refnum_value = 'RD' THEN 'Rail-to-Door'
  WHEN sref6.shipment_refnum_value = 'RR' THEN 'Rail-to-Rail'
  WHEN sref6.shipment_refnum_value = 'PR' THEN 'Pier-to-Rail'
  WHEN sref6.shipment_refnum_value = 'DR' THEN 'Door-to-Rail'
  ELSE sref6.shipment_refnum_value
  END), 'Data Missing in System') service_type,
  NVL((SELECT lr.location_refnum_value
  FROM location_refnum lr
  WHERE lr.location_gid = 'SCOULAR.' || REPLACE(cvr2.charter_voyage_refnum_value,'SCOULAR.','')
  AND lr.location_refnum_qual_gid = 'SCOULAR.FIRMS CODE'), 'Data Missing in System')
  clear_at_firms,
  NVL((SELECT l.location_name FROM location l WHERE l.location_gid = 'SCOULAR.' || REPLACE(cvr2.charter_voyage_refnum_value,'SCOULAR.','')), 'Data Missing in System')
  firms_name,  
  NVL(glogowner.xxscou_nvo_report_functions.loc_address('SCOULAR.' || REPLACE(cvr2.charter_voyage_refnum_value,'SCOULAR.','')), 'Data Missing in System')
  firms_address,
  NVL(glogowner.xxscou_nvo_report_functions.loc_city_state_zip('SCOULAR.' || REPLACE(cvr2.charter_voyage_refnum_value,'SCOULAR.','')), 'Data Missing in System')
  firms_city_state_zip,  
  NVL(sref1.shipment_refnum_value, 'Data Missing in System') place_of_delivery,
  NVL(sref2.shipment_refnum_value, 'Data Missing in System') bill_type,
  NVL(s.payment_method_code_gid, 'Data Missing in System') freight_pay_term,
  NVL(
  (SELECT lr.location_refnum_value
  FROM location_refnum lr
  WHERE lr.location_gid = sip.involved_party_contact_gid
  AND lr.location_refnum_qual_gid = 'SCOULAR/NVO.CUSTOMER PAYMENT TERMS')
  , 'Data Missing in System') freight_inco_term,
  NVL(TO_CHAR((SELECT COUNT(ssunit.s_ship_unit_gid)
  FROM shipment_stop_d sstopd
  INNER JOIN s_ship_unit ssunit ON sstopd.s_ship_unit_gid = ssunit.s_ship_unit_gid
  WHERE sstopd.shipment_gid = s.shipment_gid
  AND sstopd.stop_num = 1),'999,999,990'), 'Data Missing in System') container_count,
  NVL(TO_CHAR((SELECT SUM(TO_NUMBER(ssur.refnum_value))
  FROM shipment_stop_d ssd
  INNER JOIN s_ship_unit ssu ON ssd.s_ship_unit_gid = ssu.s_ship_unit_gid
  LEFT OUTER JOIN s_ship_unit_refnum ssur ON ssu.s_ship_unit_gid = ssur.s_ship_unit_gid
  AND ssur.s_ship_unit_refnum_qual_gid = 'SCOULAR.PIECE COUNT'
  WHERE ssd.shipment_gid = s.shipment_gid
  AND ssd.stop_num = 1),'999,999,990'), 'Data Missing in System') piece_tot,
  NVL(srem1.remark_text, 'Data Missing in System') additional_notes 
FROM
   job j
INNER JOIN
  job_order_release_join jorj ON j.job_gid = jorj.job_gid
INNER JOIN
  view_shipment_order_release vsor ON jorj.order_release_gid = vsor.order_release_gid
AND
  vsor.shipment_gid IN (
  SELECT sh.shipment_gid
  FROM shipment sh
  WHERE vsor.shipment_gid = sh.shipment_gid
  AND sh.shipment_type_gid = 'TRANSPORT'
  AND sh.transport_mode_gid = 'VESSEL-CO'
  AND sh.is_primary = 'Y'
  AND sh.perspective = 'B')  
INNER JOIN
	shipment s ON vsor.shipment_gid = s.shipment_gid
AND
	s.shipment_type_gid = 'TRANSPORT'
AND
	s.transport_mode_gid = 'VESSEL-CO'
AND
	s.is_primary = 'Y'
AND
  s.perspective = 'B'
LEFT OUTER JOIN
	shipment_refnum sr ON s.shipment_gid = sr.shipment_gid
AND
	sr.shipment_refnum_qual_gid = 'CHARTER VOYAGE'		
LEFT OUTER JOIN
	charter_voyage cv ON 'SCOULAR/NVO.' || sr.shipment_refnum_value = cv.charter_voyage_gid
LEFT OUTER JOIN
  vessel v ON cv.vessel_gid = v.vessel_gid
LEFT OUTER JOIN
	charter_voyage_refnum cvr1 ON cv.charter_voyage_gid = cvr1.charter_voyage_gid
AND
	cvr1.charter_voyage_refnum_qual_gid = 'SCOULAR.CHARVOY_VOYAGE_NUMBER'
LEFT OUTER JOIN
	charter_voyage_refnum cvr2 ON cv.charter_voyage_gid = cvr2.charter_voyage_gid
AND
	cvr2.charter_voyage_refnum_qual_gid = 'SCOULAR.CHARVOY_FIRMS_CODE'    
LEFT OUTER JOIN
	shipment_refnum sref1 ON s.shipment_gid = sref1.shipment_gid
AND
	sref1.shipment_refnum_qual_gid = 'SCOULAR/NVO.PLACE OF DELIVERY' 
LEFT OUTER JOIN
	shipment_refnum sref2 ON s.shipment_gid = sref2.shipment_gid
AND
	sref2.shipment_refnum_qual_gid = 'SCOULAR/NVO.HB_BL TYPE'  
LEFT OUTER JOIN
	shipment_refnum sref3 ON s.shipment_gid = sref3.shipment_gid
AND
	sref3.shipment_refnum_qual_gid = 'SCOULAR/NVO.HBL NUMBER OVERRIDE'	
LEFT OUTER JOIN
	shipment_refnum sref4 ON s.shipment_gid = sref4.shipment_gid
AND
	sref4.shipment_refnum_qual_gid = 'SCOULAR/NVO.VESSEL_VOYAGE'  
LEFT OUTER JOIN
	shipment_refnum sref5 ON s.shipment_gid = sref5.shipment_gid
AND
	sref5.shipment_refnum_qual_gid = 'SCOULAR/NVO.BOOKING_VESSEL_VOYAGE'    
LEFT OUTER JOIN
	shipment_refnum sref6 ON s.shipment_gid = sref6.shipment_gid
AND
	sref6.shipment_refnum_qual_gid = 'SCOULAR/NVO.SERVICE TYPE'    
LEFT OUTER JOIN
	shipment_remark srem1 ON s.shipment_gid = srem1.shipment_gid
AND
	srem1.remark_qual_gid = 'SCOULAR.ADDITIONAL NOTES'  
LEFT OUTER JOIN
  shipment_involved_party sip ON s.shipment_gid = sip.shipment_gid
AND
  sip.involved_party_qual_gid = 'BILL-TO'
WHERE
	j.job_gid = :JOB_ID
AND
	:P_RUN = 'DRAFT']]></sqlStatement>
    <sqlStatement name="Q_ENTITY1"><![CDATA[SELECT DISTINCT
    (CASE WHEN glogowner.xxscou_nvo_report_functions.entity_contact_desc(s.shipment_gid,'SHIPPER') IS NULL THEN
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        NVL(glogowner.xxscou_nvo_report_functions.entity_location_name(s.shipment_gid,'XXX','SHIPPER'), 'Data Missing in System')
      ELSE
        glogowner.xxscou_nvo_report_functions.entity_location_name(s.shipment_gid,'XXX','SHIPPER')
      END) ||
      CHR(13) ||
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        (CASE WHEN glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SHIPPER','1') IS NULL THEN
          'Data Missing in System'
        ELSE
          TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SHIPPER','1') || CHR(13) ||
          glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SHIPPER','2'))
        END)
      ELSE
        TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SHIPPER','1') || CHR(13) ||
        glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','SHIPPER','2'))
      END) ||
      CHR(13) ||
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        NVL(TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','SHIPPER',',') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','SHIPPER') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','SHIPPER') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','SHIPPER')), 'Data Missing in System') 
      ELSE
        TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','SHIPPER',',') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','SHIPPER') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','SHIPPER') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','SHIPPER'))
      END) ||
      CHR(13) || 
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        NVL(glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','SHIPPER','PH'), 'Data Missing in System') 
      ELSE
        glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','SHIPPER','PH')
      END) ||
      CHR(13) || 
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        NVL(glogowner.xxscou_nvo_report_functions.entity_fax_with_label(s.shipment_gid,'XXX','SHIPPER','FAX'), 'Data Missing in System')
      ELSE
        glogowner.xxscou_nvo_report_functions.entity_fax_with_label(s.shipment_gid,'XXX','SHIPPER','FAX')
      END)      
    ELSE
      REPLACE(glogowner.xxscou_nvo_report_functions.entity_contact_desc(s.shipment_gid,'SHIPPER'),CHR(13) || CHR(13),CHR(13))
    END)
  shipper_name
FROM
	job j
LEFT OUTER JOIN
  job_order_release_join jorj ON j.job_gid = jorj.job_gid
LEFT OUTER JOIN
  view_shipment_order_release vsor ON jorj.order_release_gid = vsor.order_release_gid
AND
  vsor.shipment_gid IN (
  SELECT sh.shipment_gid
  FROM shipment sh
  WHERE vsor.shipment_gid = sh.shipment_gid
  AND sh.shipment_type_gid = 'TRANSPORT'
  AND sh.transport_mode_gid = 'VESSEL-CO'
  AND sh.is_primary = 'Y'
  AND sh.perspective = 'B')  
LEFT OUTER JOIN
	shipment s ON vsor.shipment_gid = s.shipment_gid
AND
	s.shipment_type_gid = 'TRANSPORT'
AND
	s.transport_mode_gid = 'VESSEL-CO'
AND
	s.is_primary = 'Y'
AND
  s.perspective = 'B'
WHERE
	j.job_gid = :JOB_ID]]></sqlStatement>
    <sqlStatement name="Q_ENTITY2"><![CDATA[SELECT DISTINCT
    (CASE WHEN glogowner.xxscou_nvo_report_functions.entity_contact_desc(s.shipment_gid,'ULTIMATE CONSIGNEE') IS NULL THEN
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        NVL(glogowner.xxscou_nvo_report_functions.entity_location_name(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE'), 'Data Missing in System')
      ELSE
        glogowner.xxscou_nvo_report_functions.entity_location_name(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE')
      END) ||
      (CASE WHEN glogowner.xxscou_nvo_report_functions.entity_location_name(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE') = 'TO ORDER' 
      THEN ''
      ELSE
        CHR(13) || 
        (CASE WHEN :P_RUN = 'DRAFT' THEN
          (CASE WHEN glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE','1') IS NULL THEN
            'Data Missing in System'
          ELSE
            TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE','1') || CHR(13) ||
            glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE','2')) 
          END)
        ELSE
          TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE','1') || CHR(13) ||
          glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE','2'))
        END) ||
        CHR(13) || 
        (CASE WHEN :P_RUN = 'DRAFT' THEN
          NVL(TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE',',') || ' ' || 
          glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE') || ' ' || 
          glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE') || ' ' || 
          glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE')), 'Data Missing in System')
        ELSE
          TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE',',') || ' ' || 
          glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE') || ' ' || 
          glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE') || ' ' || 
          glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE'))
        END) ||
        CHR(13) || 
        (CASE WHEN :P_RUN = 'DRAFT' THEN
          NVL(glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE','PH'), 'Data Missing in System') 
        ELSE
          glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','ULTIMATE CONSIGNEE','PH')
        END) ||
        CHR(13) ||
        (CASE WHEN :P_RUN = 'DRAFT' THEN
          NVL(glogowner.xxscou_nvo_report_functions.entity_fax_with_label(s.shipment_gid,'SCOULAR/NVO.UC_FAX','ULTIMATE CONSIGNEE','FAX'), 'Data Missing in System') 
        ELSE
          glogowner.xxscou_nvo_report_functions.entity_fax_with_label(s.shipment_gid,'SCOULAR/NVO.UC_FAX','ULTIMATE CONSIGNEE','FAX')
        END) 
      END)
    ELSE
      REPLACE(glogowner.xxscou_nvo_report_functions.entity_contact_desc(s.shipment_gid,'ULTIMATE CONSIGNEE'), CHR(13) || CHR(13), CHR(13))
    END)
  consignee_name
FROM
	job j
LEFT OUTER JOIN
  job_order_release_join jorj ON j.job_gid = jorj.job_gid
LEFT OUTER JOIN
  view_shipment_order_release vsor ON jorj.order_release_gid = vsor.order_release_gid
AND
  vsor.shipment_gid IN (
  SELECT sh.shipment_gid
  FROM shipment sh
  WHERE vsor.shipment_gid = sh.shipment_gid
  AND sh.shipment_type_gid = 'TRANSPORT'
  AND sh.transport_mode_gid = 'VESSEL-CO'
  AND sh.is_primary = 'Y'
  AND sh.perspective = 'B')  
LEFT OUTER JOIN
	shipment s ON vsor.shipment_gid = s.shipment_gid
AND
	s.shipment_type_gid = 'TRANSPORT'
AND
	s.transport_mode_gid = 'VESSEL-CO'
AND
	s.is_primary = 'Y'
AND
  s.perspective = 'B'
WHERE
	j.job_gid = :JOB_ID]]></sqlStatement>
    <sqlStatement name="Q_ENTITY3"><![CDATA[SELECT DISTINCT
    (CASE WHEN glogowner.xxscou_nvo_report_functions.entity_contact_desc(s.shipment_gid,'NOTIFY PARTY') IS NULL THEN
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        NVL(glogowner.xxscou_nvo_report_functions.entity_name(s.shipment_gid,'SCOULAR/NVO.NP_NAME','NOTIFY PARTY'), 'Data Missing in System')
      ELSE
        glogowner.xxscou_nvo_report_functions.entity_name(s.shipment_gid,'SCOULAR/NVO.NP_NAME','NOTIFY PARTY')
      END) ||
      CHR(13) ||
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        (CASE WHEN glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'SCOULAR/NVO.NP_ADD1','NOTIFY PARTY','1') IS NULL THEN
          'Data Missing in System'
        ELSE
          TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'SCOULAR/NVO.NP_ADD1','NOTIFY PARTY','1') || CHR(13) ||
          glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'SCOULAR/NVO.NP_ADD2','NOTIFY PARTY','2'))
        END)
      ELSE
        TRIM(glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'SCOULAR/NVO.NP_ADD1','NOTIFY PARTY','1') || CHR(13) ||
        glogowner.xxscou_nvo_report_functions.entity_address(s.shipment_gid,'SCOULAR/NVO.NP_ADD2','NOTIFY PARTY','2'))      
      END) ||
      CHR(13) ||
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        NVL(TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','NOTIFY PARTY',',') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','NOTIFY PARTY') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','NOTIFY PARTY') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','NOTIFY PARTY')), 'Data Missing in System')
      ELSE
        TRIM(glogowner.xxscou_nvo_report_functions.entity_city(s.shipment_gid,'XXX','NOTIFY PARTY',',') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_province(s.shipment_gid,'XXX','NOTIFY PARTY') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_zip(s.shipment_gid,'XXX','NOTIFY PARTY') || ' ' || 
        glogowner.xxscou_nvo_report_functions.entity_country(s.shipment_gid,'XXX','NOTIFY PARTY'))
      END) ||
      CHR(13) ||
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        NVL(glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','NOTIFY PARTY','PH'), 'Data Missing in System') 
      ELSE
        glogowner.xxscou_nvo_report_functions.entity_phone_with_label(s.shipment_gid,'XXX','NOTIFY PARTY','PH')
      END) ||
      CHR(13) ||
      (CASE WHEN :P_RUN = 'DRAFT' THEN
        NVL(glogowner.xxscou_nvo_report_functions.entity_fax_with_label(s.shipment_gid,'XXX','NOTIFY PARTY','FAX'), 'Data Missing in System')
      ELSE
        glogowner.xxscou_nvo_report_functions.entity_fax_with_label(s.shipment_gid,'XXX','NOTIFY PARTY','FAX')
      END)      
    ELSE
      REPLACE(glogowner.xxscou_nvo_report_functions.entity_contact_desc(s.shipment_gid,'NOTIFY PARTY'),CHR(13) || CHR(13),CHR(13))
    END)
  notify_name
FROM
	job j
LEFT OUTER JOIN
  job_order_release_join jorj ON j.job_gid = jorj.job_gid
LEFT OUTER JOIN
  view_shipment_order_release vsor ON jorj.order_release_gid = vsor.order_release_gid
AND
  vsor.shipment_gid IN (
  SELECT sh.shipment_gid
  FROM shipment sh
  WHERE vsor.shipment_gid = sh.shipment_gid
  AND sh.shipment_type_gid = 'TRANSPORT'
  AND sh.transport_mode_gid = 'VESSEL-CO'
  AND sh.is_primary = 'Y'
  AND sh.perspective = 'B')  
LEFT OUTER JOIN
	shipment s ON vsor.shipment_gid = s.shipment_gid
AND
	s.shipment_type_gid = 'TRANSPORT'
AND
	s.transport_mode_gid = 'VESSEL-CO'
AND
	s.is_primary = 'Y'
AND
  s.perspective = 'B'
WHERE
	j.job_gid = :JOB_ID]]></sqlStatement>
    <sqlStatement name="Q_TERMS"><![CDATA[SELECT
	(CASE WHEN :P_RUN = 'FINAL' THEN
	gpr.refnum_value
	ELSE NVL(gpr.refnum_value, 'Data Missing in System') END) freight_inco_term
FROM
  job j
INNER JOIN
  job_order_release_join jorj ON j.job_gid = jorj.job_gid
INNER JOIN
  view_shipment_order_release vsor ON jorj.order_release_gid = vsor.order_release_gid
AND
  vsor.shipment_gid IN (
  SELECT sh.shipment_gid
  FROM shipment sh
  WHERE vsor.shipment_gid = sh.shipment_gid
  AND sh.shipment_type_gid = 'TRANSPORT'
  AND sh.is_primary = 'Y'
  AND sh.perspective = 'S')  
INNER JOIN
	shipment s ON vsor.shipment_gid = s.shipment_gid
AND
	s.shipment_type_gid = 'TRANSPORT'
AND
	s.is_primary = 'Y'
AND
  s.perspective = 'S'
LEFT OUTER JOIN
  shipment_involved_party sip ON s.shipment_gid = sip.shipment_gid
AND
	sip.involved_party_qual_gid = 'BILL-TO'
LEFT OUTER JOIN
	gtm_party_refnum gpr ON sip.involved_party_contact_gid = gpr.contact_gid
AND
	gpr.gtm_party_refnum_qual_gid = 'SCOULAR.PAYMENT TERMS'
WHERE
	j.job_gid = :JOB_ID]]></sqlStatement>
    <sqlStatement name="Q_ROWS"><![CDATA[SELECT 
  a.s_ship_unit_gid,
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.container_num,'Data Missing in System')
  ELSE a.container_num END) container_num,
  (CASE WHEN :P_RUN = 'DRAFT' THEN 
    (CASE WHEN NVL(TRIM(a.seal_num1 || a.seal_num2 || a.seal_num3),'XXYYZZYYXX') = 'XXYYZZYYXX' THEN
      'Data Missing in System'
    ELSE 
      TRIM(
      (CASE WHEN a.attribute1 = 'YES' THEN
        'AGENT SEAL '
      ELSE
        ''
      END) ||        
      a.seal_num1 || CHR(13) || 
      (CASE WHEN a.attribute1 = 'YES' THEN
        'CUSTOMS SEAL '
      ELSE
        ''
      END) ||         
      a.seal_num2 || CHR(13) || a.seal_num3) END)
  ELSE 
    TRIM(
    (CASE WHEN a.attribute1 = 'YES' THEN
      'AGENT SEAL '
    ELSE
      ''
    END) ||      
    a.seal_num1 || CHR(13) ||
    (CASE WHEN a.attribute1 = 'YES' THEN
      'CUSTOMS SEAL '
    ELSE
      ''
    END) ||       
    a.seal_num2 || CHR(13) || a.seal_num3)
  END) seal_num,
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.container_type,'Data Missing in System')
  ELSE a.container_type END) container_type,
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.descript_of_cargo,'Data Missing in System')
  ELSE a.descript_of_cargo END) descript_of_cargo,
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.piece_count,'Data Missing in System')
  ELSE a.piece_count END) piece_count,
  (CASE WHEN :P_RUN = 'DRAFT' THEN
    (CASE WHEN NVL(a.piece_type,'XYZZYXXYZZYX') = 'XYZZYXXYZZYX' THEN 'Data Missing in System'
    ELSE 
      (CASE WHEN TO_NUMBER(regexp_replace(a.piece_count,'^.*?(\d+)\.doc$','\1')) > 1 THEN
        (SELECT pt.plural_text
        FROM glogowner.xxscou_piece_type pt
        WHERE pt.code = a.piece_type)
      ELSE
        (SELECT pt.singular_text
        FROM glogowner.xxscou_piece_type pt
        WHERE pt.code = a.piece_type)
      END)
    END)
  ELSE 
      (CASE WHEN TO_NUMBER(regexp_replace(a.piece_count,'^.*?(\d+)\.doc$','\1')) > 1 THEN
        (SELECT pt.plural_text
        FROM glogowner.xxscou_piece_type pt
        WHERE pt.code = a.piece_type)
      ELSE
        (SELECT pt.singular_text
        FROM glogowner.xxscou_piece_type pt
        WHERE pt.code = a.piece_type)
      END)
  END) piece_type,
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.net_weight_kgs,'Data Missing in System')
  ELSE a.net_weight_kgs END) || ' kgs' 
  net_weight_kgs,
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.net_weight_lbs,'Data Missing in System')
  ELSE a.net_weight_lbs END) || ' lbs' 
  net_weight_lbs,  
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.net_volume,'Data Missing in System')
  ELSE a.net_volume END) || ' ' || a.received_volume_uom
  net_volume,  
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.it_num,'Data Missing in System')
  ELSE a.it_num END) it_num,
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.it_date,'Data Missing in System')
  ELSE a.it_date END) it_date,
  (CASE WHEN :P_RUN = 'DRAFT' THEN NVL(a.container_notes,'Data Missing in System')
  ELSE a.container_notes END) container_notes
FROM
(SELECT DISTINCT
  ssu.s_ship_unit_gid,
	ssu.tag_3 container_num,
  ssu.tag_1 seal_num1,
 (SELECT ssur.refnum_value
  FROM s_ship_unit_refnum ssur 
  WHERE ssur.s_ship_unit_gid = ssu.s_ship_unit_gid
  AND ssur.s_ship_unit_refnum_qual_gid = 'SCOULAR.CONTAINER SEAL NUMBER 2')
  seal_num2,
  (SELECT ssur.refnum_value
  FROM s_ship_unit_refnum ssur 
  WHERE ssur.s_ship_unit_gid = ssu.s_ship_unit_gid
  AND ssur.s_ship_unit_refnum_qual_gid = 'SCOULAR.CONTAINER SEAL NUMBER 3')
  seal_num3,  
  s.attribute1,
  (CASE WHEN ssu.received_ship_unit_count = 19 THEN 'LCL'
  WHEN ssu.received_ship_unit_count = 20 THEN '20 FT Standard'
  WHEN ssu.received_ship_unit_count = 21 THEN '20 FT Reefer'
  WHEN ssu.received_ship_unit_count = 40 THEN '40 FT Standard'
  WHEN ssu.received_ship_unit_count = 41 THEN '40 FT Reefer'
  WHEN ssu.received_ship_unit_count = 42 THEN '40 FT High Cube'  
  WHEN ssu.received_ship_unit_count = 45 THEN '45 FT Standard'
  WHEN ssu.received_ship_unit_count = 46 THEN '45 FT Reefer'
  ELSE ''
  END)
  container_type,
  (CASE WHEN 
    (SELECT ssur.remark_text
    FROM s_ship_unit_remark ssur 
    WHERE ssur.s_ship_unit_gid = ssu.s_ship_unit_gid
    AND ssur.remark_qual_gid = 'SCOULAR/NVO.DESCRIPTION OF CARGO OVERRIDE') IS NULL 
  THEN
    sr.remark_text 
  ELSE
    (SELECT ssur.remark_text
    FROM s_ship_unit_remark ssur 
    WHERE ssur.s_ship_unit_gid = ssu.s_ship_unit_gid
    AND ssur.remark_qual_gid = 'SCOULAR/NVO.DESCRIPTION OF CARGO OVERRIDE')   
  END)
  descript_of_cargo,
  (SELECT refnum_value 
  FROM s_ship_unit_refnum
  WHERE s_ship_unit_gid = ssu.s_ship_unit_gid
  AND s_ship_unit_refnum_qual_gid = 'SCOULAR.PIECE COUNT')
  piece_count, 
  (SELECT refnum_value 
  FROM s_ship_unit_refnum
  WHERE s_ship_unit_gid = ssu.s_ship_unit_gid
  AND s_ship_unit_refnum_qual_gid = 'SCOULAR.PIECE TYPE')
  piece_type,   
  TRIM(TO_CHAR(ROUND((CASE WHEN ssu.received_weight_uom = 'LB' THEN ssu.received_weight * 0.45359237
    WHEN ssu.received_weight_uom = 'G' THEN ssu.received_weight / 1000
    WHEN ssu.received_weight_uom = 'KG' THEN ssu.received_weight
    WHEN ssu.received_weight_uom = 'TON' OR ssu.received_weight_uom = 'T' THEN (ssu.received_weight * 2000) * 0.45359237
    WHEN ssu.received_weight_uom = 'MTON' OR ssu.received_weight_uom = 'MT' THEN ssu.received_weight * 1000
    ELSE ssu.received_weight END),3),'999,999,990.000'))
  net_weight_kgs,
  TRIM(TO_CHAR(ROUND((CASE WHEN ssu.received_weight_uom = 'LB' THEN ssu.received_weight
    WHEN ssu.received_weight_uom = 'G' THEN (ssu.received_weight / 1000) * 2.20462262  
    WHEN ssu.received_weight_uom = 'KG' THEN ssu.received_weight * 2.20462262
    WHEN ssu.received_weight_uom = 'TON' OR ssu.received_weight_uom = 'T' THEN ssu.received_weight * 2000
    WHEN ssu.received_weight_uom = 'MTON' OR ssu.received_weight_uom = 'MT' THEN ssu.received_weight * 2204.62442018
    ELSE ssu.received_weight END),3),'999,999,990.000'))
  net_weight_lbs,
  ssur4.refnum_value net_volume,
  ssur5.refnum_value received_volume_uom,
  ssur1.refnum_value it_num,
  ssur2.refnum_value it_date,
  ssur3.refnum_value container_notes
FROM
	job_order_release_join jorj
INNER JOIN
	view_shipment_order_release vsor ON jorj.order_release_gid = vsor.order_release_gid
INNER JOIN
	shipment s ON vsor.shipment_gid = s.shipment_gid
AND
	s.shipment_type_gid = 'TRANSPORT'
AND
	s.transport_mode_gid = 'VESSEL-CO'
AND
	s.is_primary = 'Y'
AND
	s.perspective = 'B'
INNER JOIN
	shipment_stop_d ssd ON s.shipment_gid = ssd.shipment_gid
AND
	ssd.stop_num = 1
INNER JOIN
	s_ship_unit ssu ON ssd.s_ship_unit_gid = ssu.s_ship_unit_gid
LEFT OUTER JOIN
  s_ship_unit_refnum ssur1 ON ssu.s_ship_unit_gid = ssur1.s_ship_unit_gid
AND
  ssur1.s_ship_unit_refnum_qual_gid = 'SCOULAR/NVO.IN TRANSIT NUMBER'
LEFT OUTER JOIN
  s_ship_unit_refnum ssur2 ON ssu.s_ship_unit_gid = ssur2.s_ship_unit_gid
AND
  ssur2.s_ship_unit_refnum_qual_gid = 'SCOULAR/NVO.IN TRANSIT DATE'  
LEFT OUTER JOIN
  s_ship_unit_refnum ssur3 ON ssu.s_ship_unit_gid = ssur3.s_ship_unit_gid
AND
  ssur3.s_ship_unit_refnum_qual_gid = 'SCOULAR/NVO.CONTAINER NOTES'
LEFT OUTER JOIN
  s_ship_unit_refnum ssur4 ON ssu.s_ship_unit_gid = ssur4.s_ship_unit_gid
AND
  ssur4.s_ship_unit_refnum_qual_gid = 'SCOULAR/NVO.CONTAINER_GROSS_VOLUME'
LEFT OUTER JOIN
  s_ship_unit_refnum ssur5 ON ssu.s_ship_unit_gid = ssur5.s_ship_unit_gid
AND
  ssur5.s_ship_unit_refnum_qual_gid = 'SCOULAR/NVO.CONTAINER_GROSS_VOLUME_UOM'  
LEFT OUTER JOIN
  shipment_refnum sref ON s.shipment_gid = sref.shipment_gid
AND
  sref.shipment_refnum_qual_gid = 'SCOULAR/NVO.ITEM DESCRIPTION'   
LEFT OUTER JOIN
  shipment_remark sr ON s.shipment_gid = sr.shipment_gid
AND
  sr.remark_qual_gid = 'SCOULAR/NVO.HBL DESCRIPTION OF CARGO' 
AND
  sr.remark_sequence = 1
WHERE
	jorj.job_gid = :JOB_ID) a
ORDER BY
  a.s_ship_unit_gid ASC  ]]></sqlStatement>
    <sqlStatement name="Q_TOTALS"><![CDATA[SELECT
  (CASE WHEN :P_RUN = 'DRAFT' THEN
    NVL(TRIM(TO_CHAR(ROUND(SUM(a.weight_kgs),3),'999,999,990.000')),'Data Missing in System')
  ELSE
    TRIM(TO_CHAR(ROUND(SUM(a.weight_kgs),3),'999,999,990.000'))
  END)
  total_weight_kgs,
  (CASE WHEN :P_RUN = 'DRAFT' THEN
    NVL(TRIM(TO_CHAR(ROUND(SUM(a.weight_lbs),3),'999,999,990.000')),'Data Missing in System')
  ELSE
    TRIM(TO_CHAR(ROUND(SUM(a.weight_lbs),3),'999,999,990.000'))
  END)
  total_weight_lbs
FROM
(SELECT DISTINCT
  ssu.s_ship_unit_gid,
  (CASE WHEN ssu.received_weight_uom = 'LB' THEN ssu.received_weight * 0.45359237
  WHEN ssu.received_weight_uom = 'G' THEN ssu.received_weight / 1000
  WHEN ssu.received_weight_uom = 'KG' THEN ssu.received_weight
  WHEN ssu.received_weight_uom = 'TON' OR ssu.received_weight_uom = 'T' THEN (ssu.received_weight * 2000) * 0.45359237
  WHEN ssu.received_weight_uom = 'MTON' OR ssu.received_weight_uom = 'MT' THEN ssu.received_weight * 1000
  ELSE ssu.received_weight END) weight_kgs,
  (CASE WHEN ssu.received_weight_uom = 'LB' THEN ssu.received_weight
  WHEN ssu.received_weight_uom = 'G' THEN (ssu.received_weight / 1000) * 2.20462262
  WHEN ssu.received_weight_uom = 'KG' THEN ssu.received_weight * 2.20462262
  WHEN ssu.received_weight_uom = 'TON' OR ssu.received_weight_uom = 'T' THEN ssu.received_weight * 2000
  WHEN ssu.received_weight_uom = 'MTON' OR ssu.received_weight_uom = 'MT' THEN ssu.received_weight * 2204.62442018
  ELSE ssu.received_weight END) weight_lbs
FROM
	job_order_release_join jorj
INNER JOIN
	view_shipment_order_release vsor ON jorj.order_release_gid = vsor.order_release_gid
INNER JOIN
	shipment s ON vsor.shipment_gid = s.shipment_gid
AND
	s.shipment_type_gid = 'TRANSPORT'
AND
	s.transport_mode_gid = 'VESSEL-CO'
AND
	s.is_primary = 'Y'
AND
	s.perspective = 'B'
INNER JOIN
	shipment_stop_d ssd ON s.shipment_gid = ssd.shipment_gid
AND
	ssd.stop_num = 1
INNER JOIN
	s_ship_unit ssu ON ssd.s_ship_unit_gid = ssu.s_ship_unit_gid
WHERE
	jorj.job_gid = :JOB_ID) a]]></sqlStatement>
  </dataQuery>
  <dataStructure>
    <group name="G_DRAFT_FINAL" source="Q_DRAFT_FINAL">
      <element name="DRAFT_FINAL" value="DRAFT_FINAL" />
    </group>
    <group name="G_MAIN" source="Q_MAIN">
      <element name="LOC_NAME" value="LOC_NAME" />
      <element name="LOC_ADDRESS" value="LOC_ADDRESS"></element>
      <element name="LOC_CITY_STATE_ZIP" value="LOC_CITY_STATE_ZIP"></element>
      <element name="LOC_PHONE" value="LOC_PHONE"></element>
      <element name="SYSTEM_DATE" value="SYSTEM_DATE"></element>
      <element name="TSC_REF_NUM" value="TSC_REF_NUM" />
      <element name="CONTACT_NAME" value="CONTACT_NAME"></element>
      <element name="CONTACT_EMAIL_PHONE" value="CONTACT_EMAIL_PHONE" />
      <element name="BILL_NAME" value="BILL_NAME"></element>
      <element name="BILL_ADDRESS" value="BILL_ADDRESS" />
      <element name="BILL_CITY_STATE_ZIP" value="BILL_CITY_STATE_ZIP" />
      <element name="BILL_CONTACT" value="BILL_CONTACT" />
      <element name="BILL_PHONE" value="BILL_PHONE"></element>
      <element name="BILL_FAX" value="BILL_FAX"></element>
      <element name="CUST_REF_NO" value="CUST_REF_NO" />
      <element name="MASTER_BILL_LADING" value="MASTER_BILL_LADING"></element>
      <element name="HOUSE_BILL_LADING" value="HOUSE_BILL_LADING" />
      <element name="AMS_BILL_LADING" value="AMS_BILL_LADING"></element>
      <element name="VESSEL_NAME" value="VESSEL_NAME" />
      <element name="VOYAGE_NAME" value="VOYAGE_NAME" />
      <element name="LOAD_PORT" value="LOAD_PORT" />
      <element name="DISCHARGE_PORT" value="DISCHARGE_PORT"></element>
      <element name="DEPARTURE_DATE" value="DEPARTURE_DATE" />
      <element name="ARRIVAL_DATE" value="ARRIVAL_DATE" />
      <element name="SERVICE_TYPE" value="SERVICE_TYPE"></element>
      <element name="CLEAR_AT_FIRMS" value="CLEAR_AT_FIRMS"></element>
      <element name="FIRMS_NAME" value="FIRMS_NAME" />
      <element name="FIRMS_ADDRESS" value="FIRMS_ADDRESS"></element>
      <element name="FIRMS_CITY_STATE_ZIP" value="FIRMS_CITY_STATE_ZIP"></element>
      <element name="PLACE_OF_DELIVERY" value="PLACE_OF_DELIVERY" />
      <element name="BILL_TYPE" value="BILL_TYPE"></element>
      <element name="FREIGHT_PAY_TERM" value="FREIGHT_PAY_TERM" />
      <element name="CONTAINER_COUNT" value="CONTAINER_COUNT" />
      <element name="PIECE_TOT" value="PIECE_TOT" />
      <element name="ADDITIONAL_NOTES" value="ADDITIONAL_NOTES" />
    </group>
    <group name="G_ENTITY1" source="Q_ENTITY1">
      <element name="SHIPPER_NAME" value="SHIPPER_NAME" />
    </group>
    <group name="G_ENTITY2" source="Q_ENTITY2">
      <element name="CONSIGNEE_NAME" value="CONSIGNEE_NAME" />
    </group>
    <group name="G_ENTITY3" source="Q_ENTITY3">
      <element name="NOTIFY_NAME" value="NOTIFY_NAME" />
    </group>
    <group name="G_TERMS" source="Q_TERMS">
      <element name="FREIGHT_INCO_TERM" value="FREIGHT_INCO_TERM"></element>
    </group>
    <group name="G_ROWS" source="Q_ROWS">
      <element name="CONTAINER_NUM" value="CONTAINER_NUM" />
      <element name="SEAL_NUM" value="SEAL_NUM" />
      <element name="SEAL_NUM_TWO" value="SEAL_NUM_TWO"></element>
      <element name="CONTAINER_TYPE" value="CONTAINER_TYPE" />
      <element name="DESCRIPT_OF_CARGO" value="DESCRIPT_OF_CARGO" />
      <element name="PIECE_COUNT" value="PIECE_COUNT" />
      <element name="PIECE_TYPE" value="PIECE_TYPE"></element>
      <element name="NET_WEIGHT_KGS" value="NET_WEIGHT_KGS" />
      <element name="NET_WEIGHT_LBS" value="NET_WEIGHT_LBS" />
      <element name="NET_VOLUME" value="NET_VOLUME"></element>
      <element name="IT_NUM" value="IT_NUM" />
      <element name="IT_DATE" value="IT_DATE" />
      <element name="CONTAINER_NOTES" value="CONTAINER_NOTES"></element>
    </group>
    <group name="G_TOTALS" source="Q_TOTALS">
      <element name="TOTAL_WEIGHT_KGS" value="TOTAL_WEIGHT_KGS"></element>
      <element name="TOTAL_WEIGHT_LBS" value="TOTAL_WEIGHT_LBS"></element>
    </group>
  </dataStructure>
</dataTemplate>